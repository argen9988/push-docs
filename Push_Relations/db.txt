
DROP TABLE "ASD"."ASD_TB_PUSH_TOKEN_USER_T" CASCADE CONSTRAINTS;
CREATE TABLE "ASD"."ASD_TB_PUSH_TOKEN_USER_T" (	
	"ID" NUMBER, 
	"DEVICE_ID" VARCHAR2(100 BYTE) NOT NULL, 
	"DEVICE_MARKET_NAME" VARCHAR2(100 BYTE), 
	"DEVICE_OS" VARCHAR2(20 BYTE) DEFAULT 'ANDROID' NOT NULL, 
	"OS_VERSION" VARCHAR2(20 BYTE), 
	"APP_VERSION" VARCHAR2(20 BYTE), 
	"USER_ID" VARCHAR2(20 BYTE), 
	"HASHED_PUSHTOKEN" CLOB NOT NULL, 
	"PUSH_ENABLE" VARCHAR2(1 BYTE) DEFAULT 'Y' NOT NULL,
	"END_DATE" DATE, 
	"CREATION_DATE" DATE NOT NULL, 
	"CREATED_BY" VARCHAR2(20 BYTE) NOT NULL, 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	CONSTRAINT "ASD_TB_PUSH_TOKEN_USER_T_PK" PRIMARY KEY ("ID"),
	CONSTRAINT "ASD_TB_PUSH_TOKEN_USER_T_UK1" UNIQUE ("DEVICE_ID"),
	CONSTRAINT "CKC_ASD_TB_PUSH_TOKEN_USER_T_DEVICE_OS" CHECK (DEVICE_OS in ('ANDROID','IOS'),
	CONSTRAINT "CKC_ASD_TB_PUSH_TOKEN_USER_T_PUSH_ENABLE" CHECK (PUSH_ENABLE in ('Y','N') )
);


COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."ID" IS '序號';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."DEVICE_ID" IS '裝置代號';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."DEVICE_MARKET_NAME" IS '裝置市場名稱';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."DEVICE_OS" IS '裝置作業系統';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."OS_VERSION" IS 'OS版號';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."APP_VERSION" IS 'APP版號';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."USER_ID" IS '登入系統帳號';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."HASHED_PUSHTOKEN" IS '權杖';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."PUSH_ENABLE" IS '接受推播開關';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."END_DATE" IS '失效日';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."CREATION_DATE" IS '建立日期';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."CREATED_BY" IS '建立人員';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."LAST_MODIFY_DATE" IS '修改日期';
COMMENT ON COLUMN "ASD"."ASD_TB_PUSH_TOKEN_USER_T"."LAST_MODIFY_BY" IS '修改人員';


CREATE SEQUENCE  "ASD"."ASD_TB_PUSH_TOKEN_USER_T_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 61 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;



CREATE OR REPLACE EDITIONABLE TRIGGER "ASD"."BU_ASD_TB_PUSH_TOKEN_USER_T" 
before update on "ASD_TB_PUSH_TOKEN_USER_T"
for each row
begin
	:new.last_modify_date := sysdate;
	:new.last_modify_by := nvl(wwv_flow.g_user,user); 
end;

ALTER TRIGGER "ASD"."BU_ASD_TB_PUSH_TOKEN_USER_T" ENABLE;

CREATE OR REPLACE EDITIONABLE TRIGGER "ASD"."BI_ASD_TB_PUSH_TOKEN_USER_T" 
before insert on "ASD_TB_PUSH_TOKEN_USER_T"
for each row
begin
	if :NEW."ID" is null then
		select "ASD_TB_PUSH_TOKEN_USER_T_SEQ".nextval into :NEW."ID" from dual;
	end if;

	:new.creation_date := sysdate;
	:new.created_by := nvl(wwv_flow.g_user,user);
end;

ALTER TRIGGER "ASD"."BI_ASD_TB_PUSH_TOKEN_USER_T" ENABLE;

Insert Into ASD_TB_PUSH_TOKEN_USER_T(ID, DEVICE_ID, DEVICE_MARKET_NAME, DEVICE_OS, OS_VERSION, APP_VERSION, USER_ID, HASHED_PUSHTOKEN, END_DATE, CREATION_DATE, CREATED_BY, LAST_MODIFY_DATE, LAST_MODIFY_BY)
Select ID, DEVICE_ID, DEVICE_MARKET_NAME, DEVICE_OS, OS_VERSION, APP_VERSION, USER_ID, HASHED_FCMTOKEN, END_DATE, CREATION_DATE, CREATED_BY, LAST_MODIFY_DATE, LAST_MODIFY_BY
From ASD_TB_FCM_TOKEN_T;


ALTER TABLE "ASD"."BI_ASD_TB_PUSH_TOKEN_USER_T" ADD("PUSH_ENABLE" VARCHAR2(1 BYTE) Default 'Y' Not Null);
ALTER TABLE "ASD"."BI_ASD_TB_PUSH_TOKEN_USER_T" ADD CONSTRAINT "CKC_ASD_TB_PUSH_TOKEN_USER_T_PUSH_ENABLE" CHECK (PUSH_ENABLE in ('Y','N') );

